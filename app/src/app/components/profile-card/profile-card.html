<article class="profile-card" (click)="onView()">
  <div class="card-photo">
    @if (photoUrl) {
      <img [src]="photoUrl" [attr.alt]="profile().displayName || ('PROFILE_CARD.PHOTO_ALT' | translate)" class="profile-image" loading="lazy">
    } @else {
      <div class="photo-placeholder">
        <mat-icon>person</mat-icon>
      </div>
    }
    
    <!-- Activity Status Badge -->
    @if (profile().isOnline) {
      <span class="activity-badge online">
        <span class="activity-dot"></span>
        {{ 'PROFILE_CARD.ONLINE_BADGE' | translate }}
      </span>
    } @else if (profile().showLastActive !== false && profile().lastActiveAt) {
      <span class="activity-badge">
        <span class="activity-dot"></span>
        {{ lastActiveKey(profile().lastActiveAt) | translate:lastActiveParams(profile().lastActiveAt) }}
      </span>
    }

    <!-- Interaction Time (for matches page) -->
    @if (showInteractionTime() && profile().interactionDate) {
      <span class="interaction-time">
        {{ lastActiveKey(profile().interactionDate) | translate:lastActiveParams(profile().interactionDate) }}
      </span>
    }
  </div>

  <div class="card-content">
    <div class="card-header">
      <h3 class="card-name">
        {{ profile().displayName || ('PROFILE_CARD.ANONYMOUS_NAME' | translate) }}
        @if (profile().age) {
          <span class="card-age">, {{ profile().age }}</span>
        }
        @if (profile().isFounder) {
          <app-founder-badge size="small" [iconOnly]="true" />
        }
        @if (isVerified) {
          <mat-icon class="verified-icon" [attr.title]="'PROFILE_CARD.IDENTITY_VERIFIED_TOOLTIP' | translate">verified</mat-icon>
        }
        @if (showReputationBadge()) {
          <app-reputation-badge [tier]="reputationTier()" mode="icon" size="small" />
        }
      </h3>
      @if (profile().city) {
        <span class="card-location">
          <mat-icon>location_on</mat-icon>
          {{ profile().city }}{{ profile().country ? ', ' + profile().country : '' }}
        </span>
      }
    </div>

    @if (profile().tagline) {
      <p class="card-tagline">
        {{ profile().tagline!.slice(0, 100) }}{{ profile().tagline!.length > 100 ? '...' : '' }}
      </p>
    }

    @if (profile().connectionTypes?.length) {
      <div class="card-tags">
        @for (type of profile().connectionTypes!.slice(0, 2); track type) {
          <span class="tag">{{ connectionTypeTranslateKey(type) | translate }}</span>
        }
      </div>
    }

    <div class="card-actions">
      <button 
        type="button" 
        class="action-btn message"
        [disabled]="messagingLoading()"
        (click)="onMessage(); $event.stopPropagation()"
        [matTooltip]="'PROFILE_CARD.MESSAGE_TOOLTIP' | translate:{ name: (profile().displayName || ('PROFILE_CARD.USER_FALLBACK' | translate)) }">
        @if (messagingLoading()) {
          <mat-spinner diameter="18"></mat-spinner>
        } @else {
          <mat-icon>chat_bubble_outline</mat-icon>
        }
      </button>
      <button 
        type="button" 
        class="action-btn view"
        (click)="onView(); $event.stopPropagation()"
        [matTooltip]="'PROFILE_CARD.VIEW_PROFILE_TOOLTIP' | translate">
        <mat-icon>visibility</mat-icon>
      </button>
      <button 
        type="button" 
        class="action-btn favorite"
        [class.favorited]="isFavorited()"
        (click)="onFavorite(); $event.stopPropagation()"
        [matTooltip]="(isFavorited() ? 'PROFILE_CARD.REMOVE_FAVORITE_TOOLTIP' : 'PROFILE_CARD.ADD_FAVORITE_TOOLTIP') | translate">
        <mat-icon>{{ isFavorited() ? 'favorite' : 'favorite_border' }}</mat-icon>
      </button>
    </div>
  </div>
</article>
