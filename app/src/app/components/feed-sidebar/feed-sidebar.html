<div class="feed-sidebar">
  <!-- Stats Card -->
  <div class="sidebar-card stats-card">
    <div class="card-header">
      <h3 class="card-title">
        <mat-icon>insights</mat-icon>
        {{ 'FEED.SIDEBAR.STATS' | translate }}
      </h3>
    </div>
    
    <div class="card-content">
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-value">{{ userPostsCount() }}</span>
          <span class="stat-label">{{ 'FEED.SIDEBAR.STAT_POSTS' | translate }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ likesReceivedCount() }}</span>
          <span class="stat-label">{{ 'FEED.SIDEBAR.STAT_LIKES' | translate }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ commentsReceivedCount() }}</span>
          <span class="stat-label">{{ 'FEED.SIDEBAR.STAT_COMMENTS' | translate }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Matches Card (Feed tab only) -->
  @if (showMatchesCard()) {
    <div class="sidebar-card matches-card">
      <div class="card-header">
        <h3 class="card-title">
          <mat-icon>people</mat-icon>
          {{ 'FEED.SIDEBAR.MATCHES' | translate }}
        </h3>
        <a routerLink="/matches" class="view-all-link">
          {{ 'FEED.SIDEBAR.VIEW_ALL' | translate }}
        </a>
      </div>
      
      <div class="card-content">
        @if (displayMatches().length > 0) {
          <div class="matches-list">
            @for (match of displayMatches(); track match.uid) {
              <button type="button" class="match-item" (click)="navigateToProfile(match.uid)">
                <div class="match-avatar">
                  @if (match.photoURL) {
                    <img [src]="match.photoURL" [alt]="match.displayName">
                  } @else {
                    <div class="avatar-placeholder">
                      <mat-icon>person</mat-icon>
                    </div>
                  }
                  @if (match.isOnline && match.showOnlineStatus) {
                    <span class="online-indicator"></span>
                  }
                </div>
                <span class="match-name">{{ match.displayName }}</span>
              </button>
            }
          </div>
        } @else {
          <p class="empty-text">{{ 'FEED.SIDEBAR.NO_MATCHES' | translate }}</p>
        }
      </div>
    </div>
  }

  <!-- Private Access Card (Private tab only) - Shows who has granted YOU access -->
  @if (showPrivateAccessCard()) {
    <div class="sidebar-card private-access-card">
      <div class="card-header">
        <h3 class="card-title">
          <mat-icon>lock_open</mat-icon>
          {{ 'FEED.SIDEBAR.YOUR_ACCESS' | translate }}
        </h3>
        @if (receivedAccess().length > 0) {
          <span class="badge secondary">{{ receivedAccess().length }}</span>
        }
      </div>
      
      <div class="card-content">
        @if (displayReceivedAccess().length > 0) {
          <div class="received-access-list">
            @for (access of displayReceivedAccess(); track access.id) {
              <button type="button" class="received-access-item" (click)="navigateToProfile(access.ownerId)">
                @if (access.ownerPhoto) {
                  <img [src]="access.ownerPhoto" [alt]="access.ownerName" class="access-avatar">
                } @else {
                  <div class="avatar-placeholder small">
                    <mat-icon>person</mat-icon>
                  </div>
                }
                <span class="access-name">{{ access.ownerName }}</span>
              </button>
            }
          </div>
        } @else {
          <p class="empty-text">{{ 'FEED.SIDEBAR.NO_RECEIVED_ACCESS' | translate }}</p>
        }
      </div>
    </div>
  }

  <!-- Feed Activity Card (likes, comments on posts) -->
  <div class="sidebar-card activity-card">
    <div class="card-header">
      <h3 class="card-title">
        <mat-icon>rate_review</mat-icon>
        {{ 'FEED.SIDEBAR.POST_ACTIVITY' | translate }}
      </h3>
    </div>
    
    <div class="card-content">
      @if (displayFeedActivities().length > 0) {
        <div class="activity-list">
          @for (activity of displayFeedActivities(); track activity.id) {
            <button type="button" class="activity-item" [class.unread]="!activity.read" (click)="openPostFromActivity(activity)">
              <div class="activity-avatar">
                @if (activity.fromUserPhoto) {
                  <img [src]="activity.fromUserPhoto" [alt]="activity.fromUserName">
                } @else {
                  <div class="avatar-placeholder small">
                    <mat-icon>person</mat-icon>
                  </div>
                }
                <span class="activity-type-icon">
                  <mat-icon>{{ getFeedActivityIcon(activity) }}</mat-icon>
                </span>
              </div>
              <div class="activity-info">
                <span class="activity-text">{{ getFeedActivityMessage(activity) }}</span>
                <span class="activity-time">{{ activity.timeAgo }}</span>
              </div>
            </button>
          }
        </div>
      } @else {
        <p class="empty-text">{{ 'FEED.SIDEBAR.NO_POST_ACTIVITY' | translate }}</p>
      }
    </div>
  </div>

</div>
