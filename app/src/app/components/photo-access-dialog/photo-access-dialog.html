<div class="photo-access-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Manage Private Photo Access</h2>
    <button mat-icon-button class="close-btn" (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    @if (error()) {
      <div class="error-message">
        <mat-icon>error_outline</mat-icon>
        {{ error() }}
      </div>
    }

    <mat-tab-group>
      <!-- Pending Requests Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>pending</mat-icon>
          <span class="tab-label">Requests</span>
          @if (pendingRequests().length > 0) {
            <span class="badge">{{ pendingRequests().length }}</span>
          }
        </ng-template>
        
        <div class="tab-content">
          @if (pendingRequests().length === 0) {
            <div class="empty-state">
              <mat-icon>inbox</mat-icon>
              <p>No pending requests</p>
            </div>
          } @else {
            <div class="access-list">
              @for (request of pendingRequests(); track request.id) {
                <div class="access-item">
                  <a [routerLink]="['/user', request.id]" class="user-link" (click)="close()">
                    <img [src]="request.requesterPhoto || 'assets/default-avatar.png'" 
                         [alt]="request.requesterName"
                         class="user-photo">
                  </a>
                  <div class="user-info">
                    <a [routerLink]="['/user', request.id]" class="user-name" (click)="close()">
                      {{ request.requesterName }}
                    </a>
                    <span class="request-time">{{ formatTimeAgo(request.requestedAt) }}</span>
                  </div>
                  <div class="access-actions">
                    @if (isProcessing(request.id)) {
                      <mat-spinner diameter="20"></mat-spinner>
                    } @else {
                      <button mat-icon-button 
                              class="deny-btn" 
                              (click)="denyAccess(request)"
                              matTooltip="Deny">
                        <mat-icon>close</mat-icon>
                      </button>
                      <button mat-icon-button 
                              class="grant-btn" 
                              (click)="grantAccess(request)"
                              matTooltip="Grant Access">
                        <mat-icon>check</mat-icon>
                      </button>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </mat-tab>

      <!-- Granted Access Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>visibility</mat-icon>
          <span class="tab-label">Has Access</span>
          @if (grants().length > 0) {
            <span class="badge secondary">{{ grants().length }}</span>
          }
        </ng-template>
        
        <div class="tab-content">
          @if (grants().length === 0) {
            <div class="empty-state">
              <mat-icon>visibility_off</mat-icon>
              <p>No one has access yet</p>
            </div>
          } @else {
            <div class="access-list">
              @for (grant of grants(); track grant.id) {
                <div class="access-item">
                  <a [routerLink]="['/user', grant.id]" class="user-link" (click)="close()">
                    <img [src]="grant.grantedToPhoto || 'assets/default-avatar.png'" 
                         [alt]="grant.grantedToName"
                         class="user-photo">
                  </a>
                  <div class="user-info">
                    <a [routerLink]="['/user', grant.id]" class="user-name" (click)="close()">
                      {{ grant.grantedToName }}
                    </a>
                    <span class="grant-time">granted {{ formatTimeAgo(grant.grantedAt) }}</span>
                  </div>
                  <div class="access-actions">
                    @if (isProcessing(grant.id)) {
                      <mat-spinner diameter="20"></mat-spinner>
                    } @else {
                      <button mat-stroked-button 
                              class="revoke-btn" 
                              (click)="revokeAccess(grant)">
                        <mat-icon>block</mat-icon>
                        Revoke
                      </button>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>
</div>
