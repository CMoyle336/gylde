<div class="step-header">
  <h1 class="step-title">{{ 'ONBOARDING.STEP_1.TITLE' | translate }}</h1>
  <p class="step-subtitle">{{ 'ONBOARDING.STEP_1.SUBTITLE' | translate }}</p>
</div>

<div class="question-group">
  <span class="question-label">{{ 'ONBOARDING.STEP_1.AGE_QUESTION' | translate }}</span>
  
  <div class="options-list">
    <div class="option-item">
      <input 
        type="radio" 
        id="age-yes" 
        name="isAdult" 
        class="option-input"
        [value]="true"
        [(ngModel)]="isAdult">
      <label for="age-yes" class="option-label">
        <span class="option-indicator"></span>
        <span class="option-text">{{ 'ONBOARDING.STEP_1.AGE_YES' | translate }}</span>
      </label>
    </div>
    
    <div class="option-item">
      <input 
        type="radio" 
        id="age-no" 
        name="isAdult" 
        class="option-input"
        [value]="false"
        [(ngModel)]="isAdult">
      <label for="age-no" class="option-label">
        <span class="option-indicator"></span>
        <span class="option-text">{{ 'ONBOARDING.STEP_1.AGE_NO' | translate }}</span>
      </label>
    </div>
  </div>

  @if (isAdult === false) {
    <div class="error-message">
      <span class="material-icons-outlined">error_outline</span>
      <span>{{ 'ONBOARDING.STEP_1.AGE_REQUIRED' | translate }}</span>
    </div>
  }
</div>

@if (isAdult === true) {
  <div class="question-group">
    <span class="question-label">{{ 'ONBOARDING.STEP_1.LOCATION_QUESTION' | translate }}</span>
    
    <!-- Location Status Banner -->
    @if (locationStatus() !== 'idle') {
      <div class="location-status" [class]="locationStatus()">
        @switch (locationStatus()) {
          @case ('detecting') {
            <span class="location-spinner"></span>
            <span>{{ 'ONBOARDING.STEP_1.LOCATION_DETECTING' | translate }}</span>
          }
          @case ('success') {
            <span class="material-icons-outlined">check_circle</span>
            <span>{{ locationMessage() || ('ONBOARDING.STEP_1.LOCATION_SUCCESS' | translate) }}</span>
          }
          @case ('error') {
            <span class="material-icons-outlined">error_outline</span>
            <span>{{ locationMessage() }}</span>
            <button type="button" class="retry-btn" (click)="retryGeolocation()">
              {{ 'ONBOARDING.STEP_1.LOCATION_RETRY' | translate }}
            </button>
          }
          @case ('manual') {
            <span class="material-icons-outlined">edit_location</span>
            <span>{{ locationMessage() }}</span>
            <button type="button" class="retry-btn" (click)="retryGeolocation()">
              {{ 'ONBOARDING.STEP_1.LOCATION_USE_GPS' | translate }}
            </button>
          }
        }
      </div>
    }

    <!-- City Autocomplete Input -->
    <div class="autocomplete-wrapper">
      <div class="input-wrapper">
        <span class="input-icon material-icons-outlined">location_on</span>
        <input 
          #cityInput
          type="text" 
          class="input-field with-icon"
          [class.searching]="isSearching()"
          [placeholder]="'ONBOARDING.STEP_1.CITY_AUTOCOMPLETE_PLACEHOLDER' | translate"
          [value]="cityInputValue()"
          (input)="onInputChange($any($event.target).value)"
          (keydown)="onKeyDown($event)"
          (focus)="onInputFocus()"
          autocomplete="off"
          role="combobox"
          aria-autocomplete="list"
          [attr.aria-expanded]="showSuggestions()"
          aria-haspopup="listbox">
        @if (isSearching()) {
          <span class="input-spinner"></span>
        }
      </div>
      
      <!-- Autocomplete Suggestions Dropdown -->
      @if (showSuggestions()) {
        <ul class="suggestions-list" role="listbox">
          @for (suggestion of suggestions(); track suggestion.placeId; let i = $index) {
            <li 
              class="suggestion-item"
              [class.highlighted]="highlightedIndex() === i"
              role="option"
              [attr.aria-selected]="highlightedIndex() === i"
              (click)="selectSuggestion(suggestion)"
              (mouseenter)="highlightedIndex.set(i)">
              <span class="suggestion-icon material-icons-outlined">place</span>
              <span class="suggestion-text">
                <span class="suggestion-main">{{ suggestion.mainText }}</span>
                <span class="suggestion-secondary">{{ suggestion.secondaryText }}</span>
              </span>
            </li>
          }
        </ul>
      }
    </div>
  </div>
}
