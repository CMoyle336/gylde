<div class="profile-page">
  <!-- Header -->
  <header class="profile-header">
    <h1>My Profile</h1>
    @if (!isEditing()) {
      <button mat-stroked-button (click)="startEditing()">
        <mat-icon>edit</mat-icon>
        Edit Profile
      </button>
    } @else {
      <div class="header-actions">
        <button mat-button (click)="cancelEditing()">Cancel</button>
        <button mat-flat-button color="primary" (click)="saveProfile()" [disabled]="saving()">
          @if (saving()) {
            <mat-spinner diameter="18"></mat-spinner>
          } @else {
            <mat-icon>check</mat-icon>
          }
          Save
        </button>
      </div>
    }
  </header>

  @if (profile(); as profile) {
    <div class="profile-content">
      <!-- Reputation Status Section -->
      <section class="reputation-section">
        <div class="reputation-content">
          <div class="badges-container">
            <app-reputation-badge [tier]="reputationTier()" mode="full" size="large" />
            @if (isFounder()) {
              <app-founder-badge [city]="founderCity() ?? undefined" size="large" />
            }
          </div>
          <div class="reputation-details">
            <div class="reputation-header">
              <h2>Your Reputation Status</h2>
              <button 
                mat-icon-button 
                class="info-btn" 
                (click)="openReputationInfo()"
                matTooltip="Learn how reputation works">
                <mat-icon>info_outline</mat-icon>
              </button>
            </div>
            <p class="reputation-description">
              Your reputation reflects your behavior on the platform. 
              Higher tiers unlock more reach to higher-tier members.
            </p>
            <div class="messaging-status">
              <span class="status-item">
                <mat-icon class="status-icon">forum</mat-icon>
                @if (higherTierConversationStatus().isUnlimited) {
                  <strong>Unlimited</strong> higher tier conversations
                } @else {
                  <strong>{{ higherTierConversationStatus().remaining }}/{{ higherTierConversationStatus().dailyLimit }}</strong> higher tier conversations
                }
              </span>
            </div>
            <!-- Dev-only refresh button -->
            @if (isDev) {
              <button 
                class="dev-refresh-btn" 
                (click)="refreshReputation()" 
                [disabled]="refreshingReputation()"
                title="Recalculate reputation (dev only)">
                @if (refreshingReputation()) {
                  <mat-spinner diameter="16"></mat-spinner>
                } @else {
                  <mat-icon>refresh</mat-icon>
                }
                Refresh Reputation
              </button>
            }
          </div>
        </div>
      </section>

      <!-- Photos Section -->
      <section class="photos-section">
        <div class="section-header">
          <h2>Photos</h2>
          <span class="photo-count">{{ editablePhotos().length }} / {{ maxPhotos() }}</span>
        </div>
        <p class="section-hint">Click the star to set as profile photo. You can upload up to {{ maxPhotos() }} photos.</p>
        
        @if (uploadError()) {
          <div class="upload-error">
            <mat-icon>error_outline</mat-icon>
            <span>{{ uploadError() }}</span>
          </div>
        }
        
        <div class="photos-grid" cdkDropList cdkDropListOrientation="mixed" (cdkDropListDropped)="onPhotoDrop($event)">
          @for (photoItem of photosWithPrivacy(); track photoItem.url; let i = $index) {
            <div class="photo-item" 
                 cdkDrag
                 [cdkDragDisabled]="photoItem.isProfilePhoto"
                 [class.is-profile]="photoItem.isProfilePhoto"
                 [class.is-private]="photoItem.isPrivate"
                 [class.is-draggable]="!photoItem.isProfilePhoto">
              <div class="photo-drag-placeholder" *cdkDragPlaceholder></div>
              <img [src]="photoItem.url" alt="Profile photo {{ i + 1 }}" draggable="false">
              <div class="photo-overlay">
                @if (!photoItem.isPrivate) {
                  <button mat-icon-button 
                          [class.active]="photoItem.isProfilePhoto"
                          (click)="setAsProfilePhoto(photoItem.url)"
                          matTooltip="Set as profile photo">
                    <mat-icon>{{ photoItem.isProfilePhoto ? 'star' : 'star_outline' }}</mat-icon>
                  </button>
                }
                @if (!photoItem.isProfilePhoto) {
                  <button mat-icon-button 
                          [class.active]="photoItem.isPrivate"
                          (click)="togglePhotoPrivacy(photoItem.url)"
                          [matTooltip]="photoItem.isPrivate ? 'Make public' : 'Make private'">
                    <mat-icon>{{ photoItem.isPrivate ? 'lock' : 'lock_open' }}</mat-icon>
                  </button>
                  <button mat-icon-button 
                          class="remove-btn"
                          (click)="removePhoto(photoItem.url)"
                          matTooltip="Remove photo">
                    <mat-icon>delete</mat-icon>
                  </button>
                }
              </div>
              @if (photoItem.isProfilePhoto) {
                <div class="profile-badge">
                  <mat-icon>lock</mat-icon>
                  Profile
                </div>
              }
              @if (photoItem.isPrivate) {
                <div class="private-badge">
                  <mat-icon>lock</mat-icon>
                </div>
              }
              @if (!photoItem.isProfilePhoto) {
                <div class="drag-handle">
                  <mat-icon>drag_indicator</mat-icon>
                </div>
              }
            </div>
          }
          
          <!-- Uploading photos with individual loading states -->
          @for (uploading of uploadingPhotos(); track uploading.id) {
            <div class="photo-item uploading-item" [class.error]="uploading.status === 'error'">
              <img [src]="uploading.preview" alt="Uploading photo" class="uploading-preview">
              <div class="upload-overlay">
                @if (uploading.status === 'uploading') {
                  <div class="upload-spinner-overlay"></div>
                  <span class="upload-status">Uploading...</span>
                } @else if (uploading.status === 'error') {
                  <mat-icon class="error-icon">error</mat-icon>
                  <span class="upload-status error">{{ uploading.error || 'Failed' }}</span>
                }
              </div>
            </div>
          }
          
          <!-- Add photo button -->
          @if (editablePhotos().length + uploadingPhotos().length < maxPhotos()) {
            <button type="button" class="add-photo-btn" (click)="openPhotoPicker()">
              <mat-icon>add_photo_alternate</mat-icon>
              <span>Add Photo</span>
            </button>
          }
        </div>
        <input #photoInput type="file" accept="image/*" multiple hidden (change)="onPhotosSelected($event)">
        
        <!-- Manage Private Photo Access -->
        @if (hasPrivatePhotos()) {
          <div class="manage-access-section">
            <button mat-stroked-button class="manage-access-btn" (click)="openAccessDialog()">
              <mat-icon>lock</mat-icon>
              Manage Private Photo Access
              @if (pendingRequestsCount() > 0) {
                <span class="request-badge">{{ pendingRequestsCount() }}</span>
              }
            </button>
          </div>
        }
      </section>

      <!-- Basic Info Section -->
      <section class="info-section">
        <h2>Basic Info</h2>
        
        <div class="info-grid">
          <div class="info-item full-width">
            <label class="field-label">Tagline</label>
            @if (isEditing()) {
              <div class="input-with-ai">
                <mat-form-field appearance="outline" class="full-width-field">
                  <input matInput [(ngModel)]="editForm.tagline" placeholder="A short phrase about you..." maxlength="100">
                  <mat-hint align="end">{{ editForm.tagline.length }}/100</mat-hint>
                </mat-form-field>
                @if (isPremium() && editForm.tagline.length >= 3) {
                  <button type="button" 
                          class="ai-polish-btn" 
                          [class.loading]="polishingField() === 'tagline'"
                          [disabled]="polishingField() !== null"
                          (click)="polishText('tagline')"
                          matTooltip="Polish with AI">
                    @if (polishingField() === 'tagline') {
                      <span class="ai-spinner"></span>
                    } @else {
                      <mat-icon>auto_awesome</mat-icon>
                    }
                  </button>
                }
              </div>
              @if (polishSuggestions()?.field === 'tagline') {
                <div class="ai-suggestions">
                  <div class="suggestion-header">
                    <mat-icon>auto_awesome</mat-icon>
                    <span>AI Suggestions</span>
                    <button class="close-btn" (click)="dismissPolishSuggestions()">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                  <div class="suggestion-item primary" (click)="applyPolish(polishSuggestions()!.polished)">
                    <span>{{ polishSuggestions()!.polished }}</span>
                    <mat-icon>add</mat-icon>
                  </div>
                  @for (alt of polishSuggestions()!.alternatives; track alt) {
                    <div class="suggestion-item" (click)="applyPolish(alt)">
                      <span>{{ alt }}</span>
                      <mat-icon>add</mat-icon>
                    </div>
                  }
                </div>
              }
            } @else {
              <span class="info-value tagline-value" [class.empty]="!profile.onboarding?.tagline">
                {{ profile.onboarding?.tagline || 'Not set' }}
              </span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Display Name</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <input matInput [(ngModel)]="editForm.displayName" placeholder="Your display name">
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.displayName || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Location</label>
            @if (isEditing()) {
              <div class="location-autocomplete-wrapper">
                <!-- Region Restriction Notice (only shown when US is the only allowed region) -->
                @if (showUsOnlyNotice()) {
                  <div class="region-notice">
                    <mat-icon>public</mat-icon>
                    <span>Gylde is currently available in the United States only.</span>
                  </div>
                }
                
                <!-- Location Status Message -->
                @if (locationMessage()) {
                  <div class="location-status" [class]="locationStatus()">
                    @if (locationStatus() === 'detecting') {
                      <span class="location-spinner"></span>
                    } @else if (locationStatus() === 'success') {
                      <mat-icon>check_circle</mat-icon>
                    } @else if (locationStatus() === 'error') {
                      <mat-icon>error_outline</mat-icon>
                    }
                    <span>{{ locationMessage() }}</span>
                  </div>
                }
                
                <div class="location-input-row">
                  <div class="autocomplete-container">
                    <div class="input-wrapper">
                      <mat-icon class="input-icon">location_on</mat-icon>
                      <input 
                        #cityInput
                        type="text"
                        class="location-input"
                        [class.searching]="isSearchingLocation()"
                        placeholder="Start typing a city..."
                        [value]="cityInputValue()"
                        (input)="onLocationInputChange($any($event.target).value)"
                        (keydown)="onLocationKeyDown($event)"
                        (focus)="onLocationInputFocus()"
                        autocomplete="off"
                        role="combobox"
                        aria-autocomplete="list"
                        [attr.aria-expanded]="showSuggestions()"
                        aria-haspopup="listbox">
                      @if (isSearchingLocation()) {
                        <span class="input-spinner"></span>
                      }
                    </div>
                    
                    <!-- Autocomplete Suggestions Dropdown -->
                    @if (showSuggestions()) {
                      <ul class="suggestions-list" role="listbox">
                        @for (suggestion of suggestions(); track suggestion.placeId; let i = $index) {
                          <li 
                            class="suggestion-item"
                            [class.highlighted]="highlightedIndex() === i"
                            role="option"
                            [attr.aria-selected]="highlightedIndex() === i"
                            (click)="selectSuggestion(suggestion)"
                            (mouseenter)="highlightedIndex.set(i)">
                            <mat-icon class="suggestion-icon">place</mat-icon>
                            <span class="suggestion-text">
                              <span class="suggestion-main">{{ suggestion.mainText }}</span>
                              <span class="suggestion-secondary">{{ suggestion.secondaryText }}</span>
                            </span>
                          </li>
                        }
                      </ul>
                    }
                  </div>
                  
                  <!-- Geolocation Button -->
                  <button 
                    type="button" 
                    class="geolocation-btn"
                    [class.detecting]="locationStatus() === 'detecting'"
                    [disabled]="locationStatus() === 'detecting'"
                    (click)="requestGeolocation()"
                    matTooltip="Use my current location">
                    @if (locationStatus() === 'detecting') {
                      <span class="btn-spinner"></span>
                    } @else {
                      <mat-icon>my_location</mat-icon>
                    }
                  </button>
                </div>
              </div>
            } @else {
              <span class="info-value">
                @if (profile.onboarding; as onboarding) {
                  @if (onboarding.city) {
                    {{ onboarding.city }}, {{ onboarding.country }}
                  } @else {
                    Not set
                  }
                } @else {
                  Not set
                }
              </span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Birthday</label>
            <span class="info-value">
              @if (profile.onboarding?.birthDate; as birthDate) {
                {{ formatBirthDate(birthDate) }} ({{ calculateAge(birthDate) }} years old)
              } @else {
                Not set
              }
            </span>
          </div>

        </div>
      </section>

      <!-- Dating Preferences Section -->
      <section class="info-section">
        <h2>Dating Preferences</h2>
        
        <div class="info-grid">
          <!-- Row 1: Identity and Age Range -->
          <div class="info-item">
            <label class="field-label">I identify as</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.genderIdentity">
                  <mat-option value="woman">Woman</mat-option>
                  <mat-option value="man">Man</mat-option>
                  <mat-option value="nonbinary">Non-binary</mat-option>
                  <mat-option value="self-describe">Other</mat-option>
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ formatGender(profile.onboarding?.genderIdentity) }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Age Range</label>
            @if (isEditing()) {
              <div class="range-inputs">
                <mat-form-field appearance="outline" class="age-field">
                  <mat-label>Min</mat-label>
                  <input matInput type="number" [(ngModel)]="editForm.ageRangeMin" min="18" max="99">
                </mat-form-field>
                <span class="range-separator">to</span>
                <mat-form-field appearance="outline" class="age-field">
                  <mat-label>Max</mat-label>
                  <input matInput type="number" [(ngModel)]="editForm.ageRangeMax" min="18" max="99">
                </mat-form-field>
              </div>
            } @else {
              <span class="info-value">
                @if (profile.onboarding; as onboarding) {
                  @if (onboarding.ageRangeMin) {
                    {{ onboarding.ageRangeMin }} - {{ onboarding.ageRangeMax }}
                  } @else {
                    Not set
                  }
                } @else {
                  Not set
                }
              </span>
            }
          </div>

          <!-- Row 2: Interested in - full width for horizontal chips -->
          <div class="info-item full-width">
            <label class="field-label">Interested in</label>
            @if (isEditing()) {
              <div class="chip-group">
                @for (option of genderOptions; track option.value) {
                  <button type="button"
                          mat-stroked-button
                          [class.selected]="editForm.interestedIn.includes(option.value)"
                          (click)="toggleInterest(option.value)">
                    {{ option.label }}
                  </button>
                }
              </div>
            } @else {
              <span class="info-value">{{ formatInterests(profile.onboarding?.interestedIn) }}</span>
            }
          </div>

          <!-- Row 3: Support orientation - full width for horizontal chips -->
          <div class="info-item full-width">
            <label class="field-label">Support orientation</label>
            @if (isEditing()) {
              <div class="chip-group">
                @for (option of supportOrientationOptions; track option.value) {
                  <button type="button"
                          mat-stroked-button
                          [class.selected]="editForm.supportOrientation === option.value"
                          (click)="selectSupportOrientation(option.value)">
                    {{ option.label }}
                  </button>
                }
              </div>
            } @else {
              @if (profile.onboarding?.supportOrientation) {
                <div class="tag-list">
                  <span class="tag">{{ formatSupportOrientation(profile.onboarding?.supportOrientation) }}</span>
                </div>
              } @else {
                <span class="info-value empty">Not set</span>
              }
            }
          </div>
        </div>
      </section>

      <!-- About Me Section -->
      <section class="info-section">
        <h2>About Me</h2>
        
        <div class="info-grid full-width">
          <div class="info-item">
            <label class="field-label">Looking for</label>
            @if (isEditing()) {
              <div class="chip-group">
                @for (option of connectionTypeOptions; track option.value) {
                  <button type="button"
                          mat-stroked-button
                          [class.selected]="editForm.connectionTypes.includes(option.value)"
                          (click)="toggleConnectionType(option.value)">
                    {{ option.label }}
                  </button>
                }
              </div>
            } @else {
              @if (profile.onboarding?.connectionTypes?.length) {
                <div class="tag-list">
                  @for (type of profile.onboarding?.connectionTypes || []; track type) {
                    <span class="tag">{{ getConnectionTypeLabel(type) }}</span>
                  }
                </div>
              } @else {
                <span class="info-value empty">Not set</span>
              }
            }
          </div>

          <div class="info-item">
            <label class="field-label">My ideal relationship</label>
            @if (isEditing()) {
              <div class="input-with-ai">
                <mat-form-field appearance="outline" class="full-width-field">
                  <textarea matInput 
                            [(ngModel)]="editForm.idealRelationship" 
                            placeholder="Describe your ideal relationship..."
                            rows="3"></textarea>
                </mat-form-field>
                @if (isPremium() && editForm.idealRelationship.length >= 10) {
                  <button type="button" 
                          class="ai-polish-btn" 
                          [class.loading]="polishingField() === 'idealRelationship'"
                          [disabled]="polishingField() !== null"
                          (click)="polishText('idealRelationship')"
                          matTooltip="Polish with AI">
                    @if (polishingField() === 'idealRelationship') {
                      <span class="ai-spinner"></span>
                    } @else {
                      <mat-icon>auto_awesome</mat-icon>
                    }
                  </button>
                }
              </div>
              @if (polishSuggestions()?.field === 'idealRelationship') {
                <div class="ai-suggestions">
                  <div class="suggestion-header">
                    <mat-icon>auto_awesome</mat-icon>
                    <span>AI Suggestions</span>
                    <button class="close-btn" (click)="dismissPolishSuggestions()">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                  <div class="suggestion-item primary" (click)="applyPolish(polishSuggestions()!.polished)">
                    <span>{{ polishSuggestions()!.polished }}</span>
                    <mat-icon>add</mat-icon>
                  </div>
                  @for (alt of polishSuggestions()!.alternatives; track alt) {
                    <div class="suggestion-item" (click)="applyPolish(alt)">
                      <span>{{ alt }}</span>
                      <mat-icon>add</mat-icon>
                    </div>
                  }
                </div>
              }
            } @else {
              <span class="info-value multiline">{{ profile.onboarding?.idealRelationship || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">What support means to me</label>
            @if (isEditing()) {
              <div class="input-with-ai">
                <mat-form-field appearance="outline" class="full-width-field">
                  <textarea matInput 
                            [(ngModel)]="editForm.supportMeaning" 
                            placeholder="What does support mean to you?"
                            rows="3"></textarea>
                </mat-form-field>
                @if (isPremium() && editForm.supportMeaning.length >= 10) {
                  <button type="button" 
                          class="ai-polish-btn" 
                          [class.loading]="polishingField() === 'supportMeaning'"
                          [disabled]="polishingField() !== null"
                          (click)="polishText('supportMeaning')"
                          matTooltip="Polish with AI">
                    @if (polishingField() === 'supportMeaning') {
                      <span class="ai-spinner"></span>
                    } @else {
                      <mat-icon>auto_awesome</mat-icon>
                    }
                  </button>
                }
              </div>
              @if (polishSuggestions()?.field === 'supportMeaning') {
                <div class="ai-suggestions">
                  <div class="suggestion-header">
                    <mat-icon>auto_awesome</mat-icon>
                    <span>AI Suggestions</span>
                    <button class="close-btn" (click)="dismissPolishSuggestions()">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                  <div class="suggestion-item primary" (click)="applyPolish(polishSuggestions()!.polished)">
                    <span>{{ polishSuggestions()!.polished }}</span>
                    <mat-icon>add</mat-icon>
                  </div>
                  @for (alt of polishSuggestions()!.alternatives; track alt) {
                    <div class="suggestion-item" (click)="applyPolish(alt)">
                      <span>{{ alt }}</span>
                      <mat-icon>add</mat-icon>
                    </div>
                  }
                </div>
              }
            } @else {
              <span class="info-value multiline">{{ profile.onboarding?.supportMeaning || 'Not set' }}</span>
            }
          </div>
        </div>
      </section>

      <!-- Personal Details Section -->
      <section class="info-section">
        <h2>Personal Details</h2>
        
        <div class="info-grid">
          <div class="info-item">
            <label class="field-label">Height</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <input matInput [(ngModel)]="editForm.height" placeholder="e.g., 5'10&quot; or 178 cm">
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.height || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Weight</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <input matInput [(ngModel)]="editForm.weight" placeholder="e.g., 170 lbs or 77 kg">
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.weight || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Ethnicity</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.ethnicity" placeholder="Select...">
                  <mat-option value="">Not specified</mat-option>
                  @for (option of ethnicityOptions; track option) {
                    <mat-option [value]="option">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.ethnicity || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Relationship Status</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.relationshipStatus" placeholder="Select...">
                  <mat-option value="">Not specified</mat-option>
                  @for (option of relationshipStatusOptions; track option) {
                    <mat-option [value]="option">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.relationshipStatus || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Children</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.children" placeholder="Select...">
                  <mat-option value="">Not specified</mat-option>
                  @for (option of childrenOptions; track option) {
                    <mat-option [value]="option">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.children || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Smoking</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.smoker" placeholder="Select...">
                  <mat-option value="">Not specified</mat-option>
                  @for (option of smokerOptions; track option) {
                    <mat-option [value]="option">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.smoker || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Drinking</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.drinker" placeholder="Select...">
                  <mat-option value="">Not specified</mat-option>
                  @for (option of drinkerOptions; track option) {
                    <mat-option [value]="option">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.drinker || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Education</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.education" placeholder="Select...">
                  <mat-option value="">Not specified</mat-option>
                  @for (option of educationOptions; track option) {
                    <mat-option [value]="option">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.education || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Occupation</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <input matInput [(ngModel)]="editForm.occupation" placeholder="What do you do?">
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.occupation || 'Not set' }}</span>
            }
          </div>

          <div class="info-item">
            <label class="field-label">Income</label>
            @if (isEditing()) {
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="editForm.income" placeholder="Select...">
                  <mat-option value="">Not specified</mat-option>
                  @for (option of incomeOptions; track option) {
                    <mat-option [value]="option">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span class="info-value">{{ profile.onboarding?.income || 'Not set' }}</span>
            }
          </div>
        </div>
      </section>

    </div>
  } @else {
    <div class="loading-state">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading profile...</p>
    </div>
  }
</div>
