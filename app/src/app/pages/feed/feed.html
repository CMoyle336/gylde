@if (!configInitialized()) {
  <!-- Loading state while config initializes -->
  <div class="config-loading-state">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
} @else if (feedEnabled()) {
  <!-- Actual Feed View - Two Column Layout -->
  <div class="feed-layout" [class.private-mode]="activeTab() === 'private'">
    <!-- Main Feed Column -->
    <div class="feed-main">
      <div class="feed-container">
        <!-- Feed Header -->
        <div class="feed-header">
          <h2 class="feed-title">
            @if (activeTab() === 'private') {
              <mat-icon class="title-icon">lock</mat-icon>
            }
            {{ 'FEED.TITLE' | translate }}
          </h2>
          <!-- Mobile Drawer Toggle -->
          <button type="button" class="drawer-toggle" (click)="toggleDrawer()">
            <mat-icon>menu</mat-icon>
          </button>
        </div>

        <!-- Tab Navigation -->
        <div class="feed-tabs">
          @for (tab of tabOptions; track tab.value) {
            <button 
              type="button"
              class="tab-button"
              [class.active]="activeTab() === tab.value"
              (click)="onTabChange(tab.value)">
              <mat-icon>{{ tab.icon }}</mat-icon>
              <span>{{ tab.labelKey | translate }}</span>
            </button>
          }
        </div>

        <!-- Sub-filter (only visible on Feed tab) -->
        @if (activeTab() === 'feed') {
          <div class="sub-filter-row">
            <button type="button" [matMenuTriggerFor]="subFilterMenu" class="filter-button">
              @for (option of subFilterOptions; track option.value) {
                @if (option.value === activeSubFilter()) {
                  <mat-icon>{{ option.icon }}</mat-icon>
                  <span class="filter-label">{{ option.labelKey | translate }}</span>
                }
              }
              <mat-icon class="dropdown-icon">expand_more</mat-icon>
            </button>
            
            <mat-menu #subFilterMenu="matMenu">
              @for (option of subFilterOptions; track option.value) {
                <button 
                  mat-menu-item 
                  (click)="onSubFilterChange(option.value)"
                  [class.active]="option.value === activeSubFilter()">
                  <mat-icon>{{ option.icon }}</mat-icon>
                  <span>{{ option.labelKey | translate }}</span>
                </button>
              }
            </mat-menu>
          </div>
        }

        <!-- Post Composer -->
        <app-post-composer [activeTab]="activeTab()" (postCreated)="onPostCreated()" />

        <!-- Feed Content -->
        <div class="feed-content">
          @if (loading()) {
            <div class="loading-state">
              <mat-spinner diameter="40"></mat-spinner>
              <p>{{ 'FEED.LOADING' | translate }}</p>
            </div>
          } @else if (error()) {
            <div class="error-state">
              <mat-icon>error_outline</mat-icon>
              <p>{{ error() }}</p>
              <button mat-stroked-button (click)="refresh()">
                {{ 'FEED.TRY_AGAIN' | translate }}
              </button>
            </div>
          } @else if (isEmpty()) {
            <div class="empty-state">
              <mat-icon>dynamic_feed</mat-icon>
              <h3>{{ 'FEED.EMPTY_TITLE' | translate }}</h3>
              <p>{{ 'FEED.EMPTY_DESCRIPTION' | translate }}</p>
            </div>
          } @else {
            <!-- Post List -->
            <div class="posts-list">
              @for (post of posts(); track trackByPostId($index, post)) {
                <app-post-card
                  [post]="post"
                  [isDeleting]="deletingPostId() === post.id"
                  (likeClick)="onLike($event)"
                  (commentClick)="onComment($event)"
                  (authorClick)="onAuthorClick($event)"
                  (deleteClick)="onDelete($event)"
                  (reportClick)="onReport($event)" />
              }
            </div>

            <!-- Load More -->
            @if (hasMore()) {
              <div class="load-more-section">
                @if (loadingMore()) {
                  <mat-spinner diameter="32"></mat-spinner>
                } @else {
                  <button mat-stroked-button (click)="loadMore()">
                    {{ 'FEED.LOAD_MORE' | translate }}
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
    </div>

    <!-- Sidebar Column (Desktop) -->
    <aside class="feed-sidebar-column">
      <app-feed-sidebar [activeTab]="activeTab()" />
    </aside>

    <!-- Mobile Drawer Overlay -->
    @if (drawerOpen()) {
      <div class="drawer-overlay" (click)="closeDrawer()"></div>
    }

    <!-- Mobile Drawer -->
    <div class="mobile-drawer" [class.open]="drawerOpen()">
      <div class="drawer-header">
        <h3>{{ 'FEED.SIDEBAR.TITLE' | translate }}</h3>
        <button type="button" class="drawer-close" (click)="closeDrawer()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="drawer-content">
        <app-feed-sidebar [activeTab]="activeTab()" />
      </div>
    </div>
  </div>
} @else {
  <!-- Coming Soon Placeholder View -->
  <div class="feed-page">
    <!-- Hero Section -->
    <div class="hero-section">
      <div class="coming-soon-badge">
        <span class="material-icons-outlined">schedule</span>
        {{ 'FEED.COMING_SOON' | translate }}
      </div>
      <h1 class="hero-title">{{ 'FEED.TITLE' | translate }} <span class="text-accent">{{ 'FEED.TITLE_ACCENT' | translate }}</span></h1>
      <p class="hero-description">{{ 'FEED.DESCRIPTION' | translate }}</p>
    </div>

    <!-- Preview Section -->
    <div class="preview-section">
      <div class="preview-mockup">
        <div class="mockup-header">
          <div class="mockup-avatar"></div>
          <div class="mockup-meta">
            <div class="mockup-name"></div>
            <div class="mockup-time"></div>
          </div>
        </div>
        <div class="mockup-content">
          <div class="mockup-image"></div>
        </div>
        <div class="mockup-actions">
          <div class="mockup-action">
            <span class="material-icons-outlined">favorite_border</span>
          </div>
          <div class="mockup-action">
            <span class="material-icons-outlined">chat_bubble_outline</span>
          </div>
          <div class="mockup-action">
            <span class="material-icons-outlined">bookmark_border</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Features Section -->
    <div class="features-section">
      <h2 class="section-title">{{ 'FEED.WHAT_TO_EXPECT' | translate }}</h2>
      <p class="section-description">{{ 'FEED.WHAT_TO_EXPECT_DESCRIPTION' | translate }}</p>

      <div class="features-grid">
        @for (feature of features; track feature.titleKey) {
          <div class="feature-card">
            <div class="feature-icon">
              <span class="material-icons-outlined">{{ feature.icon }}</span>
            </div>
            <h3 class="feature-title">{{ feature.titleKey | translate }}</h3>
            <p class="feature-description">{{ feature.descriptionKey | translate }}</p>
          </div>
        }
      </div>
    </div>

    <!-- How It Works Section -->
    <div class="how-section">
      <h2 class="section-title">{{ 'FEED.HOW_IT_WORKS' | translate }}</h2>
      <div class="steps-container">
        <div class="step">
          <div class="step-number">1</div>
          <h3>{{ 'FEED.STEP_1_TITLE' | translate }}</h3>
          <p>{{ 'FEED.STEP_1_DESCRIPTION' | translate }}</p>
        </div>
        <div class="step-connector"></div>
        <div class="step">
          <div class="step-number">2</div>
          <h3>{{ 'FEED.STEP_2_TITLE' | translate }}</h3>
          <p>{{ 'FEED.STEP_2_DESCRIPTION' | translate }}</p>
        </div>
        <div class="step-connector"></div>
        <div class="step">
          <div class="step-number">3</div>
          <h3>{{ 'FEED.STEP_3_TITLE' | translate }}</h3>
          <p>{{ 'FEED.STEP_3_DESCRIPTION' | translate }}</p>
        </div>
      </div>
    </div>

    <!-- Notification Section -->
    <div class="notify-section">
      <div class="notify-card">
        <span class="material-icons-outlined notify-icon">notifications_active</span>
        <div class="notify-content">
          <h3>{{ 'FEED.NOTIFY_TITLE' | translate }}</h3>
          <p>{{ 'FEED.NOTIFY_DESCRIPTION' | translate }}</p>
        </div>
      </div>
    </div>

    <!-- Back Link -->
    <div class="back-section">
      <a routerLink="/discover" class="back-link">
        <span class="material-icons-outlined">arrow_back</span>
        {{ 'FEED.BACK_TO_DISCOVER' | translate }}
      </a>
    </div>
  </div>
}
