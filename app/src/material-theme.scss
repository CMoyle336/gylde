// Angular Material Theme Configuration
// Using the proper theming API introduced in v19
@use '@angular/material' as mat;

// Define the dark theme with custom colors
html {
  // Set to dark color scheme for the application
  color-scheme: dark;
  
  @include mat.theme((
    color: (
      // Using orange palette as base, closest to your gold (#c9a962)
      primary: mat.$orange-palette,
      tertiary: mat.$yellow-palette,
      theme-type: dark,
    ),
    typography: (
      plain-family: 'Plus Jakarta Sans',
      brand-family: 'Outfit',
      bold-weight: 600,
      medium-weight: 500,
      regular-weight: 400,
    ),
    density: 0,
  ));
}

// Override system tokens to match your custom gold accent color
html {
  @include mat.theme-overrides((
    // Primary colors - your gold accent
    primary: #c9a962,
    on-primary: #0d0b0e,
    primary-container: rgba(201, 169, 98, 0.15),
    on-primary-container: #e8d5a3,
    
    // Surface colors - your dark theme
    surface: #0d0b0e,
    surface-dim: #1a1720,
    surface-bright: #252030,
    surface-container-lowest: #0d0b0e,
    surface-container-low: #1a1720,
    surface-container: #252030,
    surface-container-high: #2d2838,
    surface-container-highest: #3d3350,
    
    // Text colors
    on-surface: #f5f3f0,
    on-surface-variant: #a8a4b0,
    
    // Outline colors
    outline: rgba(255, 255, 255, 0.15),
    outline-variant: rgba(255, 255, 255, 0.08),
    
    // Error colors
    error: #e57373,
    on-error: #0d0b0e,
  ));
}

// Form field specific overrides
html {
  @include mat.form-field-overrides((
    // Outlined variant colors
    outlined-outline-color: rgba(255, 255, 255, 0.08),
    outlined-hover-outline-color: #c9a962,
    outlined-focus-outline-color: #c9a962,
    outlined-label-text-color: #6b6777,
    outlined-hover-label-text-color: #c9a962,
    outlined-focus-label-text-color: #c9a962,
    
    // Background colors
    filled-container-color: #252030,
    hover-state-layer-opacity: 0.08,
    
    // Text colors
    filled-input-text-color: #f5f3f0,
    outlined-input-text-color: #f5f3f0,
  ));
}

// Outlined form field background (not available as a token)
.mat-mdc-form-field.mat-form-field-appearance-outline .mat-mdc-text-field-wrapper {
  background-color: var(--color-bg-elevated);
  border-radius: 4px;
  transition: background-color 0.2s ease;
}

// Datepicker specific overrides
html {
  @include mat.datepicker-overrides((
    calendar-container-background-color: #1a1720,
    calendar-container-text-color: #f5f3f0,
    calendar-body-label-text-color: #a8a4b0,
    calendar-period-button-text-color: #f5f3f0,
    calendar-navigation-button-icon-color: #a8a4b0,
    calendar-header-text-color: #f5f3f0,
    calendar-date-text-color: #f5f3f0,
    calendar-date-today-outline-color: #c9a962,
    calendar-date-selected-state-background-color: #c9a962,
    calendar-date-selected-state-text-color: #0d0b0e,
    calendar-date-hover-state-background-color: rgba(201, 169, 98, 0.15),
    calendar-date-focus-state-background-color: rgba(201, 169, 98, 0.15),
    toggle-icon-color: #6b6777,
    toggle-active-state-icon-color: #c9a962,
  ));
}

// Icon button overrides (for datepicker toggle)
html {
  @include mat.icon-button-overrides((
    icon-color: #6b6777,
    state-layer-color: #c9a962,
    hover-state-layer-opacity: 0.08,
    focus-state-layer-opacity: 0.15,
  ));
}

// Global icon button centering fix
.mat-mdc-icon-button {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  
  .mat-mdc-button-touch-target {
    position: absolute;
  }
  
  mat-icon,
  .mat-icon {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
}

// Fix for regular buttons with icons
.mat-mdc-button,
.mat-mdc-outlined-button,
.mat-mdc-flat-button,
.mat-mdc-raised-button,
.mat-mdc-stroked-button {
  mat-icon,
  .mat-icon {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    vertical-align: middle !important;
  }
}

// Slide toggle overrides
html {
  @include mat.slide-toggle-overrides((
    // Selected (on) state
    selected-handle-color: #c9a962,
    selected-track-color: rgba(201, 169, 98, 0.5),
    selected-icon-color: #0d0b0e,
    selected-hover-handle-color: #e8d5a3,
    selected-hover-track-color: rgba(201, 169, 98, 0.6),
    selected-focus-handle-color: #e8d5a3,
    selected-focus-track-color: rgba(201, 169, 98, 0.6),
    selected-pressed-handle-color: #c9a962,
    selected-pressed-track-color: rgba(201, 169, 98, 0.5),
    
    // Unselected (off) state
    unselected-handle-color: #6b6777,
    unselected-track-color: rgba(107, 103, 119, 0.3),
    unselected-icon-color: #0d0b0e,
    unselected-hover-handle-color: #a8a4b0,
    unselected-hover-track-color: rgba(107, 103, 119, 0.4),
    unselected-focus-handle-color: #a8a4b0,
    unselected-focus-track-color: rgba(107, 103, 119, 0.4),
    unselected-pressed-handle-color: #6b6777,
    unselected-pressed-track-color: rgba(107, 103, 119, 0.3),
  ));
}

body {
  // Use CSS variables for theme switching
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
  margin: 0;
  height: 100%;
  transition: background-color 0.2s ease, color 0.2s ease;
}

// ============================================
// LIGHT THEME OVERRIDES
// Override Material component colors for light mode
// ============================================

[data-theme="light"] {
  // Update color scheme for light mode
  color-scheme: light;
  
  // Material component overrides using CSS custom properties
  --mat-app-background-color: var(--color-bg-primary);
  --mat-app-text-color: var(--color-text-primary);
  
  // Primary color overrides
  --mdc-filled-button-container-color: var(--color-accent);
  --mdc-filled-button-label-text-color: var(--color-bg-primary);
  --mdc-protected-button-label-text-color: var(--color-accent);
  --mat-text-button-state-layer-color: var(--color-accent);
  
  // Form field overrides
  --mdc-outlined-text-field-outline-color: rgba(0, 0, 0, 0.23);
  --mdc-outlined-text-field-hover-outline-color: var(--color-accent);
  --mdc-outlined-text-field-focus-outline-color: var(--color-accent);
  --mdc-outlined-text-field-disabled-outline-color: rgba(0, 0, 0, 0.12);
  --mdc-outlined-text-field-label-text-color: var(--color-text-muted);
  --mdc-outlined-text-field-hover-label-text-color: var(--color-accent);
  --mdc-outlined-text-field-focus-label-text-color: var(--color-accent);
  --mdc-outlined-text-field-input-text-color: var(--color-text-primary);
  --mdc-filled-text-field-container-color: var(--color-bg-elevated);
  --mdc-filled-text-field-input-text-color: var(--color-text-primary);
  
  // Select/dropdown overrides
  --mat-select-panel-background-color: var(--color-bg-secondary);
  --mat-option-selected-state-layer-color: var(--color-accent-glow);
  --mat-option-hover-state-layer-color: var(--color-bg-hover);
  --mat-option-label-text-color: var(--color-text-primary);
  
  // Dialog overrides
  --mdc-dialog-container-color: var(--color-bg-secondary);
  --mdc-dialog-subhead-color: var(--color-text-primary);
  --mdc-dialog-supporting-text-color: var(--color-text-secondary);
  
  // Menu overrides
  --mat-menu-container-color: var(--color-bg-elevated);
  --mat-menu-item-label-text-color: var(--color-text-primary);
  --mat-menu-item-hover-state-layer-color: var(--color-bg-hover);
  
  // Icon button overrides
  --mdc-icon-button-icon-color: var(--color-text-muted);
  
  // Snackbar/toast overrides
  --mdc-snackbar-container-color: var(--color-bg-secondary);
  --mdc-snackbar-supporting-text-color: var(--color-text-primary);
  
  // Slide toggle overrides
  --mdc-switch-selected-handle-color: var(--color-accent);
  --mdc-switch-selected-track-color: var(--color-accent-glow);
  --mdc-switch-unselected-handle-color: var(--color-text-muted);
  --mdc-switch-unselected-track-color: var(--color-border);
  
  // Checkbox/radio overrides
  --mdc-checkbox-selected-checkmark-color: var(--color-bg-primary);
  --mdc-checkbox-selected-focus-icon-color: var(--color-accent);
  --mdc-checkbox-selected-hover-icon-color: var(--color-accent);
  --mdc-checkbox-selected-icon-color: var(--color-accent);
  --mdc-checkbox-unselected-icon-color: var(--color-text-muted);
  
  // Tooltip overrides
  --mdc-plain-tooltip-container-color: var(--color-bg-elevated);
  --mdc-plain-tooltip-supporting-text-color: var(--color-text-primary);
  
  // Progress spinner
  --mdc-circular-progress-active-indicator-color: var(--color-accent);
  
  // Datepicker overrides
  --mat-datepicker-calendar-container-background-color: var(--color-bg-secondary);
  --mat-datepicker-calendar-container-text-color: var(--color-text-primary);
  --mat-datepicker-calendar-date-text-color: var(--color-text-primary);
  --mat-datepicker-calendar-body-label-text-color: var(--color-text-secondary);
  --mat-datepicker-calendar-period-button-text-color: var(--color-text-primary);
  --mat-datepicker-calendar-navigation-button-icon-color: var(--color-text-secondary);
  --mat-datepicker-toggle-icon-color: var(--color-text-muted);
}

/* ============================================
   LIGHT MODE FORM FIELD FIXES
   Force input text colors for light mode
   ============================================ */

[data-theme="light"] {
  // Form field input text - these need !important to override the hardcoded dark theme values
  .mat-mdc-form-field {
    --mdc-outlined-text-field-input-text-color: var(--color-text-primary);
    --mdc-filled-text-field-input-text-color: var(--color-text-primary);
    --mdc-outlined-text-field-label-text-color: var(--color-text-muted);
    --mdc-filled-text-field-label-text-color: var(--color-text-muted);
    --mdc-outlined-text-field-caret-color: var(--color-accent);
    --mdc-filled-text-field-caret-color: var(--color-accent);
    --mdc-outlined-text-field-focus-label-text-color: var(--color-accent);
    --mdc-filled-text-field-focus-label-text-color: var(--color-accent);
  }
  
  // Select dropdown text
  .mat-mdc-select {
    --mat-select-trigger-text-color: var(--color-text-primary);
    --mat-select-placeholder-text-color: var(--color-text-muted);
    --mat-select-enabled-arrow-color: var(--color-text-muted);
    --mat-select-focused-arrow-color: var(--color-accent);
  }
  
  // Force input text color for all input elements
  .mat-mdc-input-element,
  .mat-mdc-form-field input,
  .mat-mdc-form-field textarea {
    color: var(--color-text-primary) !important;
    caret-color: var(--color-accent);
    
    &::placeholder {
      color: var(--color-text-muted);
    }
  }
  
  // Select trigger text
  .mat-mdc-select-value-text {
    color: var(--color-text-primary);
  }
  
  // Option text in dropdowns
  .mat-mdc-option {
    --mat-option-label-text-color: var(--color-text-primary);
  }
  
  // Autocomplete panel
  .mat-mdc-autocomplete-panel {
    background: var(--color-bg-secondary);
    
    .mat-mdc-option {
      color: var(--color-text-primary);
    }
  }
  
  // Slide toggle label text
  .mat-mdc-slide-toggle {
    --mdc-switch-selected-handle-color: var(--color-accent);
    --mdc-switch-selected-track-color: var(--color-accent-glow);
    --mdc-switch-selected-hover-handle-color: var(--color-accent-light);
    --mdc-switch-selected-focus-handle-color: var(--color-accent-light);
    --mdc-switch-selected-pressed-handle-color: var(--color-accent);
    --mdc-switch-unselected-handle-color: var(--color-text-muted);
    --mdc-switch-unselected-track-color: var(--color-border);
    --mat-slide-toggle-label-text-color: var(--color-text-primary);
    
    .mdc-label,
    label {
      color: var(--color-text-primary) !important;
    }
  }
  
  // Checkbox label text
  .mat-mdc-checkbox {
    --mat-checkbox-label-text-color: var(--color-text-primary);
    
    .mdc-label,
    label {
      color: var(--color-text-primary) !important;
    }
  }
  
  // Radio button label text
  .mat-mdc-radio-button {
    --mat-radio-label-text-color: var(--color-text-primary);
    
    .mdc-label,
    label {
      color: var(--color-text-primary) !important;
    }
  }
  
  // Outlined form field border fix - ensure visible borders in light mode
  .mat-mdc-form-field.mat-form-field-appearance-outline {
    .mdc-notched-outline__leading,
    .mdc-notched-outline__notch,
    .mdc-notched-outline__trailing {
      border-color: rgba(0, 0, 0, 0.23) !important;
    }
    
    &:hover .mdc-notched-outline__leading,
    &:hover .mdc-notched-outline__notch,
    &:hover .mdc-notched-outline__trailing {
      border-color: var(--color-accent) !important;
    }
    
    &.mat-focused .mdc-notched-outline__leading,
    &.mat-focused .mdc-notched-outline__notch,
    &.mat-focused .mdc-notched-outline__trailing {
      border-color: var(--color-accent) !important;
    }
  }
  
  // Form field wrapper background
  .mat-mdc-form-field.mat-form-field-appearance-outline .mat-mdc-text-field-wrapper {
    background-color: var(--color-bg-elevated);
  }
}
